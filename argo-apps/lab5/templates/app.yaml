{{- range $key := .Values.users }}
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: lab5-{{ .name }}-dev
  namespace: openshift-gitops
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    namespace: {{.name}}-dev
    server: https://kubernetes.default.svc
  project: rhte-camelk-tooling   
  source:
    helm:
      valueFiles:
       - labs/lab5/charts/dev/values.yaml
    path: labs/lab5/charts
    repoURL: http://rhte-camelk-gitea.tooling.svc.cluster.local:3000/{{.name}}/camelk-user-repository.git
    targetRevision: dev
  syncPolicy:
    syncOptions:
     - SkipDryRunOnMissingResource=true
    automated:
      selfHeal: true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: lab5-{{ .name }}-prod
  namespace: openshift-gitops
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  destination:
    namespace: {{.name}}-prod
    server: https://kubernetes.default.svc
  project: rhte-camelk-tooling   
  source:
    helm:
      valueFiles:
       - labs/lab5/charts/prod/values.yaml  
    path: labs/lab5/charts
    repoURL: http://rhte-camelk-gitea.tooling.svc.cluster.local:3000/{{.name}}/camelk-user-repository.git
    targetRevision: HEAD
  syncPolicy:
    syncOptions:
     - SkipDryRunOnMissingResource=true
    automated:
      selfHeal: true      
{{- end }}